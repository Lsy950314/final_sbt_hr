<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Create Employee</title>
    <meta charset="UTF-8">
</head>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD9AYeyskwcrm1_A8f_o0maHvMsBIiZ6BI&libraries=places"></script>
<script th:inline="javascript">
    let map;
    let marker;
    let autocomplete;
    let skillCount = 0;

    const skills = /*[[${skills}]]*/[];

    function initMap() {
        const initialLocation = { lat: 35.6895, lng: 139.6917 };

        map = new google.maps.Map(document.getElementById('map'), {
            center: initialLocation,
            zoom: 12
        });

        marker = new google.maps.Marker({
            map: map,
            position: initialLocation,
            draggable: true
        });

        const input = document.getElementById('address');
        autocomplete = new google.maps.places.Autocomplete(input);
        autocomplete.bindTo('bounds', map);

        autocomplete.addListener('place_changed', function() {
            const place = autocomplete.getPlace();
            if (!place.geometry) {
                alert("No details available for input: '" + place.name + "'");
                return;
            }

            map.setCenter(place.geometry.location);
            map.setZoom(15);

            marker.setPosition(place.geometry.location);

            document.getElementById('latitude').value = place.geometry.location.lat();
            document.getElementById('longitude').value = place.geometry.location.lng();
        });
    }

    function addSkillCareer() {
        const skillCareerContainer = document.getElementById('skillCareerContainer');
        const index = skillCareerContainer.children.length;

        const skillCareerItem = document.createElement('div');
        skillCareerItem.classList.add('skillCareer-item');

        let skillOptions = '';
        skills.forEach(skill => {
            skillOptions += `<option value="${skill.skillId}">${skill.skillName}</option>`;
        });

        skillCareerItem.innerHTML = `
            <div class="form-group">
                <label for="employeesskill[${index}].skill.skillId">Skill:</label>
                <select id="employeesskill[${index}].skill.skillId" name="employeesSkillRequests[${index}].skill.skillId" required>
                    ${skillOptions}
                </select>
            </div>
            <div class="form-group">
                <label for="employeesSkillRequests[${index}].skillCareer">Skill Career:</label>
                <input type="number" id="employeesSkillRequests[${index}].skillCareer" name="employeesSkillRequests[${index}].skillCareer" required>
            </div>
        `;
        skillCareerContainer.appendChild(skillCareerItem);
    }
    /*Spring MVC는 폼 데이터를 자바 객체로 바인딩할 때, 폼 필드의 name 속성과 객체의 속성 경로를 매핑하여 데이터를 설정합니다. 예를 들어:

name="employeesSkillRequests[0].skill.skillId"는 employeesRequest.getEmployeesSkillRequests().get(0).getSkill().getSkillId()와 매핑됩니다.
name="employeesSkillRequests[0].skillCareer"는 employeesRequest.getEmployeesSkillRequests().get(0).getSkillCareer()와 매핑됩니다.
이를 통해 EmployeesRequest 객체의 employeesSkillRequests 리스트 필드가 자동으로 설정되고, 리스트 내 각 EmployeesSkillRequest 객체의 skill 필드와 skillCareer 필드가 설정됩니다.*/

    window.onload = function() {
        initMap();
    };
</script>
<style>
    #map {
        height: 350px;
        width: 350px;
    }

    button{
        font-family: "Noto Sans JP", sans-serif; /* 일본어 텍스트에 어울리는 글꼴 사용 */
        font-size: 0.8rem; /* 글자 크기 */
        color: #fff; /* 텍스트 색상 */
        background: linear-gradient(
                45deg,
                #4a90e2, /* 파란색 계열 시작 색상 */ #87cefa /* 파란색 계열 끝 색상 */
        ); /* 버튼 배경색 그라데이션 */
        border: none; /* 기본 테두리 제거 */
        border-radius: 20px; /* 둥근 테두리 */
        padding: 7px 14px; /* 내부 여백 */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 상자 그림자 */
        cursor: pointer; /* 커서 변경 */
        transition: background 0.3s ease, transform 0.3s ease; /* 부드러운 전환 효과 */
    }

    /*body {*/
    /*    font-family: 'Arial', sans-serif;*/
    /*    background-color: #f4f7f6;*/
    /*    color: #333;*/
    /*    margin: 0;*/
    /*    padding: 20px;*/
    /*}*/

    h1 {
        text-align: center;
        font-size: 24px;
        color: #4CAF50;
        margin-bottom: 20px;
    }

    form {
        max-width: 600px;
        margin: 0 auto;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    label {
        display: block;
        font-weight: bold;
        margin-bottom: 8px;
        color: #333;
    }

    input[type="text"], input[type="date"], select, input[type="file"] {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 16px;
    }

    input[type="text"]:focus, input[type="date"]:focus, select:focus, input[type="file"]:focus {
        border-color: #4CAF50;
        outline: none;
    }

    button[type="submit"], button[type="button"] {
        width: 100%;
        padding: 12px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 10px;
    }

    button[type="submit"]:hover, button[type="button"]:hover {
        background-color: #45a049;
    }

    .form-group {
        margin-bottom: 20px;
    }

    a {
        display: block;
        text-align: center;
        color: #4CAF50;
        margin-top: 20px;
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }


</style>
<body onload="initMap()">
<h1>Create Employee(Photo)</h1>
<form th:action="@{/employees/createemployee}" th:object="${employeesRequest}" method="post" enctype="multipart/form-data">
    <label for="name">Name:</label>
    <input type="text" id="name" th:field="*{name}" placeholder="Enter name" required/><br/>

    <label for="address">Address:</label>
    <input type="text" id="address" th:field="*{address}" placeholder="Enter address" required/><br/>

<!--    <label for="latitude" style="display: none;">Latitude:</label>-->
    <input type="text" id="latitude" style="display: none;" th:field="*{latitude}" readonly/><br/>

<!--    <label for="longitude" style="display: none;">Longitude:</label>-->
    <input type="text" id="longitude" style="display: none;" th:field="*{longitude}" readonly/><br/>

    <div id="map" style="display: none;"></div>

    <label for="lastProjectEndDate">Last Project End Date:</label>
    <input type="date" id="lastProjectEndDate" th:field="*{lastProjectEndDate}"/><br/>

    <label for="currentProjectEndDate">Current Project End Date:</label>
    <input type="date" id="currentProjectEndDate" th:field="*{currentProjectEndDate}"/><br/>

    <div class="form-group">
        <label for="imageFile">Upload Image:</label>
        <input type="file" id="imageFile" name="imageFile" required>
    </div>

    <div class="form-group">
        <label for="preferredLanguage">Preferred Language:</label>
        <select id="preferredLanguage" th:field="*{preferredLanguage}" required>
            <option th:each="skill : ${skills}" th:value="${skill.skillId}" th:text="${skill.skillName}">Select Language</option>
        </select>
    </div>

    <div class="form-group">
        <label for="preferredProjectType">Preferred Project Type:</label>
        <select id="preferredProjectType" th:field="*{preferredProjectType}" required>
            <option th:each="type : ${projectTypes}" th:value="${type.projectTypeId}" th:text="${type.projectTypeName}">Select Project Type</option>
        </select>
    </div>

    <label for="contactNumber">Contact Number:</label>
    <input type="text" id="contactNumber" th:field="*{contactNumber}" placeholder="Enter contact number"/><br/>

    <label for="hireDate">Hire Date:</label>
    <input type="date" id="hireDate" th:field="*{hireDate}"/><br/>

    <!-- Skill Career 섹션 -->
    <div id="skillCareerContainer"></div>
    <div class="form-group">
        <button type="button" onclick="addSkillCareer()">Add SkillCareer</button>
    </div>

    <br/>

    <button type="submit">Create Employee</button>
</form>

<a href="/employees">Back to Employees List</a>
</body>
</html>
