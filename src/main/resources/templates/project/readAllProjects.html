<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Project List</title>
    <style>
        /* 기존 스타일 */
        body {
            width: 1920px;
            height: 1080px;
        }

        ul {
            list-style: none;
        }

        .menu {
            background-color: #1e90ff;
            width: 350px;
            height: 1080px;
        }

        .menus > li {
            width: 300px;
            height: 40px;
            justify-content: center;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.3s ease;
            text-align: center;
            font-size: 18px;
        }

        .menus {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .menus li:hover {
            background: linear-gradient(45deg, #1e90ff, #00bfff);
            color: #fff;
            border-top-right-radius: 40px;
            border-bottom-right-radius: 40px;
        }

        .contents {
            background-color: #f5f5f5;
            width: 1500px;
            height: 1080px;
        }

        .projects {
            width: 1280px;
            height: 800px;
            background: rgba(173, 216, 230, 0.2); /* 하늘색 투명 배경 */
            border: 1px solid rgba(173, 216, 230, 0.3); /* 투명한 경계 */
            border-radius: 15px; /* 둥근 모서리 */
            backdrop-filter: blur(10px); /* 글라스 효과 */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* 약간의 그림자 */
            /*display: flex;*/
            color: #333; /* 어두운 글자색 */
            font-family: "Arial", sans-serif; /* 깔끔한 폰트 */
            text-align: center;
        }

        .projects > div {
            display: flex;
            margin-right: 40px;
            overflow: hidden; /* Clearfix 효과를 위해 추가 */
        }

        .projects > div > div {
            margin-left: 10px;
            margin-right: 10px;
            float: left;
            width: 200px; /* 각 div의 고정된 너비 */
            margin-bottom: 10px; /* 간격을 주기 위해 추가 */
            box-sizing: border-box; /* 패딩과 테두리를 포함한 크기 계산 */
        }

        .modal {
            display: none; /* 숨김 처리 */
            position: fixed; /* 모달을 화면 중앙에 고정 */
            z-index: 1; /* 다른 콘텐츠 위에 표시 */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4); /* 투명한 배경 */
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* 중앙 정렬 */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* 너비 조정 */
        }


        .modal-button {
            font-family: "Noto Sans JP", sans-serif; /* 일본어 텍스트에 어울리는 글꼴 사용 */
            font-size: 1rem; /* 글자 크기 */
            color: #fff; /* 텍스트 색상 */
            background: linear-gradient(
                    45deg,
                    #4a90e2, /* 파란색 계열 시작 색상 */ #87cefa /* 파란색 계열 끝 색상 */
            ); /* 버튼 배경색 그라데이션 */
            border: none; /* 기본 테두리 제거 */
            border-radius: 20px; /* 둥근 테두리 */
            padding: 10px 20px; /* 내부 여백 */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 상자 그림자 */
            cursor: pointer; /* 커서 변경 */
            transition: background 0.3s ease, transform 0.3s ease; /* 부드러운 전환 효과 */
        }

        .header {
            display: flex;
        }

        .header > div {
            font-weight: bold;
            background-color: #f0f0f0;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .row > div {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .row > div:nth-child(6) {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-projects > div {
            display: flex;
        }

        /* 모달 본문 */

        #modal-body {
            display: flex;

            gap: 20px;
        }

        /*#modal-body > div {*/
        /*    padding: 20px;*/
        /*    border: 1px solid #1e90ff;*/
        /*    border-radius: 10px;*/
        /*    background: #f0f8ff;*/
        /*    color: #000;*/
        /*}*/


        /*.modal-projectRequirements li {*/
        /*    border-bottom: 1px solid #1e90ff;*/
        /*    padding: 5px 0;*/
        /*    color: #333;*/
        /*}*/

        #project-info {
            display: table;
            width: 100%;
            border-collapse: collapse;
            font-family: Arial, sans-serif;
            margin: 20px 0;
        }

        #project-info .data-row {
            display: table-row;
        }

        #project-info .label, #project-info .value {
            display: table-cell;
            padding: 10px;
            border: 1px solid #ddd;
            vertical-align: top;
        }

        #project-info .label {
            background-color: #f4f4f4;
            font-weight: bold;
            width: 20%;
        }

        #project-info .value {
            width: 80%;
        }

        .modal-projectRequirements div {
            margin-bottom: 10px;
        }

        #project-info ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #project-info li {
            margin-bottom: 5px;
        }

        #add-projects {
            margin-left: 870px;
            font-family: "Noto Sans JP", sans-serif; /* 일본어 텍스트에 어울리는 글꼴 사용 */
            font-size: 13px; /* 글자 크기 */
            color: #fff; /* 텍스트 색상 */
            background: linear-gradient(
                    45deg,
                    #4a90e2, /* 파란색 계열 시작 색상 */ #87cefa /* 파란색 계열 끝 색상 */
            ); /* 버튼 배경색 그라데이션 */
            border: none; /* 기본 테두리 제거 */
            border-radius: 20px; /* 둥근 테두리 */
            padding: 5px 10px; /* 내부 여백 */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 상자 그림자 */
            cursor: pointer; /* 커서 변경 */
            transition: background 0.3s ease, transform 0.3s ease; /* 부드러운 전환 효과 */
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        #button-container {
            display: flex;
            gap: 10px;
        }

        /* update-btn 스타일 */
        #update-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #6c757d; /* 회색 계열 */
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        /* update-btn 호버 효과 */
        #update-btn:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        /* update-btn 활성화 효과 */
        #update-btn:active {
            background-color: #545b62;
            transform: translateY(0);
        }

        /* delete-btn 스타일 */
        #delete-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #6c757d; /* 회색 계열 */
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }

        /* delete-btn 호버 효과 */
        #delete-btn:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        /* delete-btn 활성화 효과 */
        #delete-btn:active {
            background-color: #545b62;
            transform: translateY(0);
        }


    </style>
</head>
<body>
<div style="display: flex">
    <div class="menu">
        <ul class="menus">
            <li><a href="">Dashboard</a></li>
            <li><a href="/employees/list2">社員リスト</a></li>
            <li><a href="/readAllProjects">Projects</a></li>
        </ul>
    </div>


    <div class="contents">
        <p style="font-size: 26px">プロジェクトリスト <span><button th:onclick="createProject()" id="add-projects">プロジェクト追加</button></span>
        </p>

        <!--        필터링 및 정렬        -->
        <input type="text" id="filterByProjectName" placeholder="프로젝트 이름 검색" oninput="filterByProjectName()">
        <select id="sortProjectsByDate" onchange="sortProjectsByDate()">
            <option value="startDate">프로젝트 시작일 순</option>
            <option value="endDate">프로젝트 종료일 순</option>
        </select>
        <!--    직접 검색하지 않고 아이디 값 받아와서 검색할 때     -->
        <input type="text" id="filterByProjectId" oninput="filterByProjectId()" style="display: none">
        <!--        프로젝트 상태에 따라 필터링         -->
        <select id="filterByStatus" onchange="filterByStatus()">
            <option value="">모든 상태</option>
            <option value="-1">미배정</option>
            <option value="1">배정완료</option>
            <option value="2">완료</option>
        </select>

        <div class="projects">
            <div class="header">
                <div>プロジェクトID</div>
                <div>プロジェクト名</div>
                <div>クライアント会社</div>
                <div>プロジェクト開始日</div>
                <div>プロジェクト終了日</div>
                <div>詳細を見る</div>
            </div>
            <div class="project" th:each="p : ${session.projects}">
                <div th:text="${p.projectId}"></div>
                <div th:text="${p.projectName}"></div>
                <div th:text="${p.clientCompany}"></div>
                <div th:text="${p.startDate}"></div>
                <div th:text="${p.endDate}"></div>
                <div th:text="${p.status}" style="display: none;"></div>
                <div>
                    <button class="modal-button" th:onclick="'showProjectDetails('+${p.projectId}+')'">詳細を見る
                    </button>
                </div>
            </div>
        </div>


        <!-- 모달 팝업 -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close-button" onclick="closeModal()">&times;</span>
                <div id="modal-body">
                    <!-- 여기에 동적으로 내용이 추가됩니다 -->
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    function filterByStatus() {
        const selectedStatus = document.getElementById('filterByStatus').value;
        const projects = document.querySelectorAll('.projects > .project');

        projects.forEach(project => {
            const projectStatus = project.querySelector('div:nth-child(6)').textContent.trim();

            // 선택된 상태와 프로젝트 상태가 일치하거나, 모든 상태가 선택된 경우
            if (selectedStatus === "" || projectStatus === selectedStatus) {
                project.style.display = '';
            } else {
                project.style.display = 'none';
            }
        });
    }

    function filterByProjectId() {
        const inputId = document.getElementById('filterByProjectId').value.trim();
        const projects = document.querySelectorAll('.projects > .project');

        projects.forEach(project => {
            const projectId = project.querySelector('div:nth-child(1)').textContent.trim();

            if (projectId === inputId || inputId === "") {
                project.style.display = '';
            } else {
                project.style.display = 'none';
            }
        });
    }

    function filterByProjectName() {
        const filter = document.getElementById('filterByProjectName').value.toLowerCase();
        const projects = document.querySelectorAll('.projects > .project');

        projects.forEach(project => {
            const projectName = project.querySelector('div:nth-child(2)').textContent.toLowerCase();
            if (projectName.includes(filter)) {
                project.style.display = "";
            } else {
                project.style.display = "none";
            }
        });
    }

    function sortProjectsByDate() {
        const sortBy = document.getElementById('sortProjectsByDate').value;
        const projects = Array.from(document.querySelectorAll('.projects > .project'));
        const projectsContainer = document.querySelector('.projects');

        const currentDate = new Date();

        const futureProjects = projects.filter(project => {
            const projectDate = new Date(project.querySelector(`div:nth-child(${sortBy === 'startDate' ? 4 : 5})`).textContent);
            return projectDate >= currentDate;
        });

        // 현재 날짜보다 이전의 항목들 (과거)
        const pastProjects = projects.filter(project => {
            const projectDate = new Date(project.querySelector(`div:nth-child(${sortBy === 'startDate' ? 4 : 5})`).textContent);
            return projectDate < currentDate;
        });

        futureProjects.sort((a, b) => {
            const aValue = new Date(a.querySelector(`div:nth-child(${sortBy === 'startDate' ? 4 : 5})`).textContent);
            const bValue = new Date(b.querySelector(`div:nth-child(${sortBy === 'startDate' ? 4 : 5})`).textContent);
            return aValue - bValue;
        });

        // 과거 항목들을 정렬
        pastProjects.sort((a, b) => {
            const aValue = new Date(a.querySelector(`div:nth-child(${sortBy === 'startDate' ? 4 : 5})`).textContent);
            const bValue = new Date(b.querySelector(`div:nth-child(${sortBy === 'startDate' ? 4 : 5})`).textContent);
            return aValue - bValue;
        });

        // 정렬된 순서대로 다시 배치
        futureProjects.concat(pastProjects).forEach(project => {
            projectsContainer.appendChild(project);
        });

        // 그 아래에 과거 프로젝트를 배치
        pastProjects.forEach(project => {
            projectsContainer.appendChild(project);
        });
    }


    function createProject() {
        location.href = "/createProject"
    }

    function updateProject(projectId) {
        location.href = "/updateProject?id=" + projectId;
    }

    function deleteProject(projectId) {
        if (confirm("정말로 삭제하시겠습니까?")) {
            location.href = "/deleteProject?id=" + projectId;
        }
    }

    function readEmployeesByProjectId(projectId) {
        alert(projectId);
        // 임의의 매핑으로 projectId 가져가서 속한 List<employees> 구하기
    }

    function showProjectDetails(projectId) {

        fetch(`/getInfoByProjectID?id=${projectId}`)
            .then(response => response.json())
            .then(data => {
                console.log(data)
                const modalBody = document.getElementById('modal-body');
                modalBody.innerHTML = `
                    <div id="project-info">
    <div class="data-row">
        <div class="label">プロジェクトID:</div>
        <div class="value">${data.projectId}</div>
    </div>
    <div class="data-row">
        <div class="label">プロジェクト要件:</div>
        <div class="value modal-projectRequirements">
            ${data.projectRequirements.map(req => `
                <div>
                    スキル: ${req.skill.skillName},
                    必要経験: ${req.requiredExperience}ヶ月,
                    必要人数: ${req.requiredCount}人 + test
                </div>
            `).join('')}
        </div>
    </div>
    <div class="data-row">
        <div class="label">従業員プロジェクト:</div>
        <div class="value">
            <ul>
                 ${data.employeesProjects.map(empProj => `
                <li>
        직원 이름: ${empProj.employeeName || 'N/A'}
    </li>
            `).join('')}
            </ul>
            <button onclick="readEmployeesByProjectId(${data.projectId})"> 참여 사원 상세보기 </button>
        </div>
    </div>
    <div class="data-row">
        <div class="label">従業員:</div>
        <div class="value">
            <ul>

            </ul>
        </div>
    <div id="button-container">
    <button id="update-btn">수정</button>
    <button id="delete-btn">삭제</button>
</div> </div>
</div>

                    <div>
        <button onclick="navigateToMatchManagement()">매치버튼</button>
    </div>
                `;

                document.getElementById('update-btn').addEventListener('click', function () {
                    updateProject(projectId);
                })

                document.getElementById('delete-btn').addEventListener('click', function () {
                    deleteProject(projectId);
                })
                openModal();
            })
            .catch(error => {
                console.error('Error fetching project details:', error);
            });
    }

    function navigateToMatchManagement() {
        window.location.href = /*[[@{/matchManagement}]]*/ '/matchManagement';
    }

    function openModal() {
        document.getElementById('modal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }

    window.onclick = function (event) {
        if (event.target == document.getElementById('modal')) {
            closeModal();
        }
    }
</script>
</body>
</html>
